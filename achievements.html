<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achievements - CodeQuest</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ† Achievements</h1>
            <nav>
                <a href="index.html">â† Dashboard</a>
            </nav>
        </header>

        <div class="achievements-container">
            <div class="achievements-overview">
                <h3>Achievement Progress</h3>
                
                <div class="achievement-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="unlocked-count">0</div>
                        <div class="stat-label">Unlocked</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="total-count">6</div>
                        <div class="stat-label">Total</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="progress-percentage">0%</div>
                        <div class="stat-label">Progress</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="total-xp">0</div>
                        <div class="stat-label">Total XP</div>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="achievement-progress"></div>
                </div>
            </div>

            <div class="achievements-grid">
                <h3>All Achievements</h3>
                <div id="achievements-container" class="achievements-list">
                    <!-- Achievements will be populated by JavaScript -->
                </div>
            </div>

            <div class="achievement-actions">
                <button id="check-achievements" class="btn primary-btn">ğŸ” Check Progress</button>
                <button id="simulate-unlock" class="btn secondary-btn">ğŸ¯ Simulate Unlock</button>
                <button id="trigger-challenge" class="btn secondary-btn">ğŸ† Trigger Challenge</button>
                <button id="trigger-streak" class="btn secondary-btn">ğŸ”¥ Trigger Streak</button>
                <button id="award-xp" class="btn secondary-btn">â­ Award XP</button>
                <button id="export-data" class="btn secondary-btn">ğŸ’¾ Export Data</button>
                <button id="import-data" class="btn secondary-btn">ğŸ“ Import Data</button>
                <button id="reset-data" class="btn secondary-btn">ğŸ”„ Reset Data</button>
            </div>
            
            <div class="data-management" style="margin-top: 20px;">
                <input type="file" id="import-file" accept=".json" style="display: none;">
            </div>
        </div>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/achievements.js"></script>
    
    <script>
        // Update achievement display when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if (window.achievementSystem) {
                    window.achievementSystem.updateAchievementDisplay();
                    updateAchievementStats();
                }
            }, 100);
        });

        function updateAchievementStats() {
            if (!window.achievementSystem) return;
            
            const unlocked = window.achievementSystem.getUnlockedCount();
            const total = window.achievementSystem.getTotalCount();
            const percentage = window.achievementSystem.getProgressPercentage();
            const totalXP = window.achievementSystem.getTotalXP();
            
            document.getElementById('unlocked-count').textContent = unlocked;
            document.getElementById('total-count').textContent = total;
            document.getElementById('progress-percentage').textContent = percentage + '%';
            document.getElementById('total-xp').textContent = totalXP;
            document.getElementById('achievement-progress').style.width = percentage + '%';
        }

        // Event listeners for buttons
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('check-achievements').addEventListener('click', () => {
                if (window.achievementSystem) {
                    window.achievementSystem.checkAchievements();
                    updateAchievementStats();
                }
            });

            document.getElementById('simulate-unlock').addEventListener('click', () => {
                if (window.achievementSystem) {
                    // Simulate unlocking first achievement for demo
                    window.achievementSystem.unlockAchievement('first-steps');
                    updateAchievementStats();
                }
            });

            document.getElementById('trigger-challenge').addEventListener('click', () => {
                // Trigger a challenge completion event
                AchievementSystem.triggerChallengeCompleted({
                    id: 'test-challenge',
                    time: 90000, // 1.5 minutes (fast completion)
                    attempts: 1, // First attempt
                    score: 100
                });
            });

            document.getElementById('trigger-streak').addEventListener('click', () => {
                // Trigger a streak update event
                AchievementSystem.triggerStreakUpdated({
                    current: 7, // 7-day streak
                    longest: 10
                });
            });

            document.getElementById('award-xp').addEventListener('click', () => {
                if (window.achievementSystem) {
                    // Award test XP
                    window.achievementSystem.awardXP(100, 'Test XP Award');
                    updateAchievementStats();
                }
            });

            document.getElementById('export-data').addEventListener('click', () => {
                if (window.achievementSystem) {
                    const data = window.achievementSystem.exportAchievementData();
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `achievements_${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                }
            });

            document.getElementById('import-data').addEventListener('click', () => {
                document.getElementById('import-file').click();
            });

            document.getElementById('import-file').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file && window.achievementSystem) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const success = window.achievementSystem.importAchievementData(e.target.result);
                        alert(success ? 'Data imported successfully!' : 'Failed to import data.');
                        if (success) updateAchievementStats();
                    };
                    reader.readAsText(file);
                }
            });

            document.getElementById('reset-data').addEventListener('click', () => {
                if (confirm('Are you sure you want to reset all achievement data? This cannot be undone.')) {
                    if (window.achievementSystem) {
                        window.achievementSystem.resetAchievementData();
                        updateAchievementStats();
                        alert('Achievement data reset successfully!');
                    }
                }
            });
        });
    </script>
</body>
</html>